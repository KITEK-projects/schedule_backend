import requests
import time

URL = f"http://127.0.0.1:8000/api/v1/schedule/"

clients = [
    "ВБ-11",
    "ГД-31",
    "ГД-41",
    "ИСП-11",
    "ИСП-21",
    "ИСП-31",
    "ИСП-41",
    "ИСР-11",
    "ИСР-12",
    "ИСР-21",
    "ИСР-22",
    "ИСР-31",
    "ИСР-41",
    "ПКД-11",
    "ПКД-12",
    "ПКД-13",
    "ПКД-21",
    "ПКД-22",
    "ПКД-23",
    "ПКД-24",
    "ПКД-31",
    "ПКД-32",
    "ПКД-33",
    "ПКД-34",
    "ПКД-41",
    "ПКД-42",
    "ПКД-43",
    "ПКД-44",
    "ПСО-31",
    "ТГ-21",
    "ТГ-22",
    "ТЭ-11",
    "ТЭ-12",
    "ТЭ-21",
    "ТЭ-22",
    "ТЭ-31",
    "ТЭ-32",
    "Ю-11",
    "Ю-21",
    "Абилова Т. Н.",
    "Арнольд Ю. А.",
    "Бакаева Н. А.",
    "Балашова Т. А.",
    "Бекбергенова Г. К.",
    "Белан А. С.",
    "Бондарь Н. В.",
    "Винокурова Н. А.",
    "Воропанова Е. Н.",
    "Гаврилова М. М.",
    "Горбачев С. В.",
    "Грамотеева Н. А.",
    "Ефимова Е. Е.",
    "Жемжурина А. В.",
    "Завалий Н. Ф.",
    "Загорулько И. Г.",
    "Загребнев В. Ю.",
    "Зайцева Л. В.",
    "Захарова Ж. Н.",
    "Иванова Л. В.",
    "Кадочникова Л. Н.",
    "Казакевич Е. А.",
    "Казакова О. А.",
    "Калыкова М. К.",
    "Касенова Г. С.",
    "Кириллова И. А.",
    "Ковалева Е. А.",
    "Козка Я. В.",
    "Колиева М. А.",
    "Колмогорцева Ю. А.",
    "Константинова В. А.",
    "Королева В. А.",
    "Кудрявцева Л. А.",
    "Кузнецов Д. Л.",
    "Кузьмина Н. В.",
    "Кутикова Т. Ю.",
    "Кутиков П. А.",
    "Ли А. А.",
    "Лобурец В. В.",
    "Лоренц Р. А.",
    "Малкова Л. В.",
    "Маслова Н. А.",
    "Митракова Н. А.",
    "Митрохин В. Г.",
    "Мусаева Д. К.",
    "Мусафирова А. С.",
    "Наумова А. А.",
    "Новикова О. Ю.",
    "Орлова В. М.",
    "Павленко А. В.",
    "Паленая Т. Н.",
    "Петрова В. В.",
    "Покутная В. А.",
    "Полошков Н. В.",
    "Понякшина М. В.",
    "Пугачев И. А.",
    "Ракова К. А.",
    "Речкина Е. В.",
    "Романюк Ю. В.",
    "Россолов Д. С.",
    "Савельева Ю. С.",
    "Севернюк И. А.",
    "Смирнова Л. П.",
    "Смолиженко О. А.",
    "Спирина Н. А.",
    "Старостина Н. А.",
    "Стафеева Е. В.",
    "Степаненко Н. Д.",
    "Степанова Г. В.",
    "Сулейменова Д. О.",
    "Суманова А. А.",
    "Танкова Я. С.",
    "Тупышев А. А.",
    "Федорова Г. Н.",
    "Фурман В. А.",
    "Хохлов И. И.",
    "Шертман И. Р.",
    "шеф-повар",
    "Широкова Е. Г.",
    "Шуваева Н. И.",
    "Яковлева Н. И.",
]

response_times = []


def test_response_time(client_name: str):
    start = time.time()
    response = requests.get(
        URL + f"?client_name={client_name}",
        headers={"X-CLIENT-TIME": "2021-01-12T22:47:25+06:00"},
    )
    end = time.time()

    response_time = end - start
    response_times.append(response_time)

    print(f"\nClient: {client_name}")
    print(f"Status Code: {response.status_code}")
    print(f"Response Time: {response_time:.4f} seconds")

    if response_time > 0.2:
        print(f"[{client_name.upper()}] WARNING: Slow response time!")
    else:
        print(f"[{client_name.upper()}] Response time OK.")


if __name__ == "__main__":
    for client in clients:
        test_response_time(client)
        time.sleep(0.4)  # пауза между запросами

    # Сводка
    print("\n=== SUMMARY ===")
    avg_time = sum(response_times) / len(response_times)
    slow_count = sum(1 for t in response_times if t > 0.2)
    total_requests = len(response_times)

    print(f"Average response time: {avg_time:.4f} seconds")
    print(f"Total requests: {total_requests}")
    print(f"Slow responses (>200ms): {slow_count}")

    # Оценка максимального количества запросов в минуту при идеальной загрузке CPU 3.3GHz
    # Допущение: каждый запрос требует ~avg_time CPU времени (что приближенно)
    if avg_time > 0:
        approx_rps = int(1 / avg_time)
        rpm = approx_rps * 60
        print(f"Approx. RPS (1 core @ 3.3GHz): {approx_rps} req/s")
        print(f"Approx. RPM (1 core): {rpm} req/min")
    else:
        print("Average time is zero? Check data.")
